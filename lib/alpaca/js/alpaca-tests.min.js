/*!
Alpaca Version 1.0.4

Copyright 2013 Gitana Software, Inc.

Licensed under the Apache License, Version 2.0 (the "License"); 
you may not use this file except in compliance with the License. 

You may obtain a copy of the License at 
	http://www.apache.org/licenses/LICENSE-2.0 

Unless required by applicable law or agreed to in writing, software 
distributed under the License is distributed on an "AS IS" BASIS, 
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
See the License for the specific language governing permissions and 
limitations under the License. 

For more information, please contact Gitana Software, Inc. at this
address:

  info@gitanasoftware.com
*/
(function(a){module("fields: text");test("Simple text field with only string data input",function(){stop();a("#text-1").alpaca({data:"I Love Alpaca Ice Cream!",postRender:function(b){expect(2);var c=a("#text-1 input:text");ok(c.length,"Text input field generated.");equal(c.val(),"I Love Alpaca Ice Cream!","Input field value populated correctly.");start()}})});test("Text field with data, schema and options",function(){stop();a("#text-2").alpaca({data:"Mint Chocolate",options:{label:"Ice Cream",helper:"Your favorite ice cream?",placeholder:"Enter an Ice Cream flavor",size:30},schema:{minLength:3,maxLength:8},postRender:function(c){expect(11);var f=a("#text-2 input:text");ok(f.length,"Text input field generated.");equal(f.val(),"Mint Chocolate","Input field value populated correctly.");equal(f.attr("size"),"30","Input field size set.");equal(f.attr("placeholder"),"Enter an Ice Cream flavor","Input field placeholder set.");var b=a("#text-2 .alpaca-controlfield-label>div");ok(b.length,"Input field label generated.");equal(b.text(),"Ice Cream","Label text populated correctly.");var g=a("#text-2 .alpaca-controlfield-helper > span.alpaca-controlfield-helper-text");ok(g.length,"Input field helper generated.");equal(g.text(),"Your favorite ice cream?","Helper text populated correctly.");var e=a("#text-2 .alpaca-field-invalid");ok(e.length,"Input field marked as invalid.");var d=a("#text-2 .alpaca-controlfield-message-text");ok(d.length,"Field error message generated.");equal(d.text(),Alpaca.substituteTokens(c.view.getMessage("stringTooLong"),[8]),"Error message text populated correctly.");start()}})});test("Text field with data, schema, options and custom view",function(){stop();a("#text-3").alpaca({data:"Mint",options:{label:"Ice Cream",helper:"Your favorite ice cream?",placeholder:"Enter an Ice Cream flavor",size:30},schema:{minLength:3,maxLength:8},view:{parent:"VIEW_WEB_EDIT",styles:{".alpaca-controlfield-label":{"float":"left",padding:"6px 0.3em 0 0"}}},postRender:function(c){expect(12);var f=a("#text-3 input:text");ok(f.length,"Text input field generated.");equal(f.val(),"Mint","Input field value populated correctly.");equal(f.attr("size"),"30","Input field size set.");equal(f.attr("placeholder"),"Enter an Ice Cream flavor","Input field placeholder set.");var b=a("#text-3 .alpaca-controlfield-label>div");ok(b.length,"Input field label generated.");equal(b.text(),"Ice Cream","Label value populated correctly.");equal(b.parent().css("float"),"left","Label float style injected correctly.");equal(b.parent().css("padding-top"),"6px","Label padding style injected correctly.");var g=a("#text-3 .alpaca-controlfield-helper > span.alpaca-controlfield-helper-text");ok(g.length,"Input field helper generated.");equal(g.text(),"Your favorite ice cream?","Helper text populated correctly.");var e=a("#text-3 .alpaca-field-invalid");ok(e.length==0,"Input field not marked as invalid.");var d=a("#text-3 .alpaca-controlfield-message-text");ok(d.length==0,"Field error message not generated.");start()}})})}(jQuery));(function(a){module("fields: checkbox");test("Simple checkbox field with only boolean data input",function(){stop();a("#checkbox-1").alpaca({data:false,postRender:function(b){expect(2);var c=a("#checkbox-1 input:checkbox");ok(c.length,"Checkbox input field generated.");equal(c.is(":checked"),false,"Checkbox field value populated correctly.");start()}})});test("Checkbox field with label and right label",function(){stop();a("#checkbox-2").alpaca({data:true,options:{label:"Question:",rightLabel:"Do you like Alpaca?"},postRender:function(c){expect(6);var e=a("#checkbox-2 input:checkbox");ok(e.length,"Checkbox input field generated.");equal(e.is(":checked"),true,"Checkbox field value populated correctly.");var b=a("#checkbox-2 .alpaca-controlfield-label>div");ok(b.length,"Checkbox field label generated.");equal(b.text(),"Question:","Label text populated correctly.");var d=a("#checkbox-2 .alpaca-controlfield-checkbox > span > label");ok(d.length,"Checkbox field right label generated.");equal(d.text(),"Do you like Alpaca?","Right label text populated correctly.");start()}})})}(jQuery));(function(a){module("fields: number");test("Simple number field with only number data input",function(){stop();a("#number-1").alpaca({data:15,postRender:function(b){expect(2);var c=a("#number-1 input:text");ok(c.length,"Input field generated.");equal(c.val(),"15","Field value populated correctly.");start()}})});test("Number field with label and right label",function(){stop();a("#number-2").alpaca({data:3.55,options:{label:"Gas Price:",helper:"Enter Gas Price in Your Neighborhood"},schema:{minimum:2.1,maximum:3.25},postRender:function(c){expect(13);var f=a("#number-2 input:text");ok(f.length,"Input field generated.");equal(f.val(),"3.55","Field value populated correctly.");var b=a("#number-2 .alpaca-controlfield-label>div");ok(b.length,"Field label generated.");equal(b.text(),"Gas Price:","Label text populated correctly.");var g=a("#number-2 .alpaca-controlfield-helper > span.alpaca-controlfield-helper-text");ok(g.length,"Input field helper generated.");equal(g.text(),"Enter Gas Price in Your Neighborhood","Helper text populated correctly.");var e=a("#number-2 .alpaca-field-invalid");ok(e.length,"Input field marked as invalid.");var d=a("#number-2 .alpaca-controlfield-message-text");ok(d.length,"Field error message generated.");equal(d.text(),Alpaca.substituteTokens(c.view.getMessage("stringValueTooLarge"),[3.25]),"Error message text populated correctly.");f.blur(function(){if(f.val()=="1.11"){var i=a("#number-2 .alpaca-field-invalid");ok(i.length,"Input field marked as invalid with value 1.11.");var h=a("#number-2 .alpaca-controlfield-message-text");ok(h.length,"Field error message generated.");equal(h.text(),Alpaca.substituteTokens(c.view.getMessage("stringValueTooSmall"),[2.1]),"Error message text populated correctly.")}if(f.val()=="2.22"){var i=a("#number-2 .alpaca-field-invalid");ok(i.length==0,"Input field marked as valid with value 2.22.")}});f.val("1.11");f.blur();f.val("2.22");f.blur();start()}})})}(jQuery));(function(a){module("fields: any");test("Any field with data and schema",function(){stop();a("#any-1").alpaca({data:"I Love Alpaca Ice Cream!",schema:{title:"Ice Cream",type:"any"},postRender:function(c){expect(4);var d=a("#any-1 input:text");ok(d.length,"Text input field generated.");equal(d.val(),"I Love Alpaca Ice Cream!","Input field value populated correctly.");var b=a("#any-1 .alpaca-controlfield-label>div");ok(b.length,"Input field label generated.");equal(b.text(),"Ice Cream","Label text populated correctly.");start()}})})}(jQuery));(function(a){module("fields: array");test("Array field with only array data input",function(){stop();a("#array-1").alpaca({data:["test1","test2","test3"],postRender:function(b){expect(20);var e=a("#array-1 input:text:eq(0)");ok(e.length,"First text input field generated.");equal(e.val(),"test1","First input field value populated correctly.");var d=a("#array-1 input:text:eq(1)");ok(d.length,"Second text input field generated.");equal(d.val(),"test2","Second input field value populated correctly.");var c=a("#array-1 input:text:eq(2)");ok(c.length,"Third text input field generated.");equal(c.val(),"test3","Third input field value populated correctly.");e.hover(function(){var i=e.attr("id");var f=a("#array-1 #"+i+"-item-container > .alpaca-fieldset-array-item-toolbar");ok(f.length,"First item toolbar generated.");var h=a("button",f);equal(h.length,4,"Four buttons generated.");var g=a("button.alpaca-fieldset-array-item-toolbar-add",f);ok(g.length,"Add button generated.");g.click(function(){var j=a("#array-1 input:text:eq(1)");ok(j.length,"New text input field generated.");equal(j.val(),"test1","New input field value populated correctly.");var k=j.attr("id");var m=a("#array-1 #"+k+"-item-container > .alpaca-fieldset-array-item-toolbar");var l=a("button.alpaca-fieldset-array-item-toolbar-remove",m);ok(l.length,"Remove button generated.");l.click(function(){var o=a("#array-1 input:text");equal(o.length,3,"Item removed successfully.");var n=a("button.alpaca-fieldset-array-item-toolbar-up",f);ok(n.length,"Up button generated.");n.click(function(){var q=a("#array-1 input:text:eq(0)");equal(q.val(),"test3","New first input field value populated correctly.");var p=a("#array-1 input:text:eq(2)");equal(p.val(),"test1","New last input field value populated correctly.");f=a("#array-1 #"+i+"-item-container > .alpaca-fieldset-array-item-toolbar");var r=a("button.alpaca-fieldset-array-item-toolbar-down",f);ok(r.length,"Down button generated.");r.click(function(){var s=a("#array-1 input:text:eq(0)");equal(s.val(),"test1","New first input field value populated correctly.");var t=a("#array-1 input:text:eq(2)");equal(t.val(),"test3","New last input field value populated correctly.")});r.click()});n.click()});l.click()});g.click()},function(){var g=e.attr("id");var f=a("#array-1 #"+g+"-item-container > .alpaca-fieldset-array-item-toolbar");ok(f.length,"First item toolbar generated.");e.mouseenter()});e.mouseleave();start()}})});test("Array field with options and schema",function(){stop();a("#array-2").alpaca({data:["M"],options:{label:"Ice Cream",helper:"Favorite Ice Cream",itemLabel:"Favorite"},schema:{description:"My Favorite Ice Creams",type:"array",items:{title:"Ice Cream",type:"string",minLength:3,maxLength:8,minItems:2,maxItems:2}},postRender:function(e){expect(22);var h=a("#array-2 input:text:eq(0)");ok(h.length,"First text input field generated.");equal(h.val(),"M","First input field value populated correctly.");var c=h.attr("id");var g=a("#array-2 .alpaca-fieldset-helper");ok(g.length,"Array helper generated.");equal(g.text(),"Favorite Ice Cream","Array helper text populated correctly.");var i=a("#array-2 #"+c+"-item-container > .alpaca-controlfield-label > div");ok(i.length,"Item label generated.");equal(i.text(),"Favorite 1","Item label text populated correctly.");var f=a("#array-2 #"+c+"-controlfield-label > div");ok(f.length,"Array item label generated.");equal(f.text(),"Ice Cream","Array item label text populated correctly.");var j=a("#array-2 #"+c+"-field-message-0 > .alpaca-controlfield-message-text");ok(j.length,"Array item invalid message generated.");equal(j.text(),Alpaca.substituteTokens(e.view.getMessage("stringTooShort"),[3]),"Array item invalid text populated correctly.");var d=a("#array-2 fieldset.alpaca-field-invalid");ok(d.length,"Array marked as invalid.");var k=d.attr("alpaca-field-id");var b=a("#array-2 #"+k+"-field-message-0 > .alpaca-controlfield-message-text");ok(b.length,"Array invalid message generated.");equal(b.text(),Alpaca.substituteTokens(e.view.getMessage("notEnoughItems"),[2]),"Array invalid text populated correctly.");h.hover(function(){var p=h.attr("id");var l=a("#array-2 #"+p+"-item-container > .alpaca-fieldset-array-item-toolbar");ok(l.length,"First item toolbar generated.");var n=a("button.alpaca-fieldset-array-item-toolbar-remove",l);ok(n.length,"Remove button generated.");var o=n.button("option","disabled");ok(o,"Remove button disabled.");var m=a("button.alpaca-fieldset-array-item-toolbar-add",l);ok(m.length,"Add button generated.");m.click(function(){var q=a("#array-2 input:text:eq(1)");ok(q.length,"New text input field generated.");equal(q.val(),"M","New input field value populated correctly.");var r=a("#array-2 #"+k+"-field-message-0");ok(r.length==0,"Array invalid message removed.");l=a("#array-2 #"+p+"-item-container > .alpaca-fieldset-array-item-toolbar");m=a("button.alpaca-fieldset-array-item-toolbar-add",l);var s=m.button("option","disabled");ok(s,"Add button disabled.")});m.click()},function(){var m=h.attr("id");var l=a("#array-2 #"+m+"-item-container > .alpaca-fieldset-array-item-toolbar");ok(l.length,"First item toolbar generated.");h.mouseenter()});h.mouseleave();start()}})});test("Array field with array default value",function(){stop();a("#array-3").alpaca({schema:{description:"My Favorite Ice Creams",type:"array","default":'["Vanilla","Mint","Moose Track"]',items:{title:"Ice Cream",type:"string",minLength:3,maxLength:8,minItems:2,maxItems:5}},postRender:function(b){expect(6);var e=a("#array-3 input:text:eq(0)");ok(e.length,"First text input field generated.");equal(e.val(),"Vanilla","First input field value populated correctly.");var d=a("#array-3 input:text:eq(1)");ok(d.length,"Second text input field generated.");equal(d.val(),"Mint","Second input field value populated correctly.");var c=a("#array-3 input:text:eq(2)");ok(c.length,"Third text input field generated.");equal(c.val(),"Moose Track","Third input field value populated correctly.");start()}})});test("Array field with string default value",function(){stop();a("#array-4").alpaca({schema:{description:"My Favorite Ice Creams",type:"array","default":"Vanilla",items:{title:"Ice Cream",type:"string"}},postRender:function(b){expect(2);var c=a("#array-4 input:text:eq(0)");ok(c.length,"First text input field generated.");equal(c.val(),"Vanilla","First input field value populated correctly.");start()}})});test("Array field with item type as object",function(){stop();a("#array-5").alpaca({schema:{description:"My Favorite Ice Creams",type:"array",items:{title:"Ice Cream",type:"object",properties:{flavor:{title:"Flavor",description:"Ice cream flavor",type:"string"},topping:{title:"Topping",description:"Ice cream topping",type:"string"}}}},postRender:function(c){expect(9);var b=a("#array-5 .alpaca-fieldset-array-toolbar-add");ok(b.length,"Array toolbar with add button generated.");b.click(function(){var k=a("#array-5 .alpaca-fieldset-items-container fieldset");var h=k.attr("alpaca-field-id");ok(k.length,"New object field generated.");var g=a("input:text:eq(0)",k);ok(g.length,"New object first text input field generated.");var l=g.attr("id");var e=a("#"+l+"-controlfield-label > div",k);ok(e.length,"Label for new object first text input field generated.");equal(e.text(),"Flavor","Label for new object first text input field populated with correct text.");var f=a("input:text:eq(1)",k);ok(f.length,"New object second text input field generated.");var d=f.attr("id");var j=a("#"+d+"-controlfield-label > div",k);ok(j.length,"Label for new object second text input field generated.");equal(j.text(),"Topping","Label for second object first text input field populated with correct text.");var i=a("#array-5 #"+h+"-item-container .alpaca-fieldset-array-item-toolbar .alpaca-fieldset-array-item-toolbar-remove");i.click(function(){b=a("#array-5 .alpaca-fieldset-array-toolbar-add");ok(b.length,"Array toolbar re-generated once all items are removed.")});i.click()});b.click();start()}})});test("Nested array field",function(){stop();a("#array-6").alpaca({schema:{description:"Ice Cream Prices",type:"array",items:{title:"Flavor Price",type:"array",items:{title:"Price",type:"number"}}},postRender:function(c){expect(4);var b=a("#array-6 .alpaca-fieldset-array-toolbar-add");ok(b.length,"Array toolbar with add button generated.");b.click(function(){var e=a("#array-6 .alpaca-fieldset-items-container fieldset");ok(e.length,"New array item field generated.");var d=a(".alpaca-fieldset-array-toolbar .alpaca-fieldset-array-toolbar-add",e);ok(d.length,"Sub array toolbar with add button generated.");d.click(function(){var f=a("input:text:eq(0)",e);ok(f.length,"Sub array item text input field generated.")});d.click()});b.click();start()}})})}(jQuery));(function(a){module("fields: object");test("Simple object field with only object data input.",function(){stop();a("#object-1").alpaca({data:{name:"Taylor Swift",age:18},postRender:function(b){expect(4);var d=a("#object-1 input:text:eq(0)");ok(d.length,"First text input field generated.");equal(d.val(),"Taylor Swift","First input field value populated correctly.");var c=a("#object-1 input:text:eq(1)");ok(c.length,"Second text input field generated.");equal(c.val(),"18","Second input field value populated correctly.");start()}})});test("Object field with data and schema.",function(){stop();a("#object-2").alpaca({data:{name:"Taylor Swift",age:18},schema:{title:"Customer Profile",description:"Customer Contact Information",type:"object",properties:{name:{title:"Full Name",description:"Enter Your Full Name",type:"string"},age:{title:"Age",type:"number"}}},postRender:function(c){expect(12);var h=a("#object-2 input:text:eq(0)");ok(h.length,"First text input field generated.");equal(h.val(),"Taylor Swift","First input field value populated correctly.");var j=h.attr("id");var d=a("#object-2 #"+j+"-controlfield-label > div");ok(d.length,"First text input field label generated.");equal(d.text(),"Full Name","First input field label text populated correctly.");var e=a("#object-2 #"+j+"-controlfield-helper .alpaca-controlfield-helper-text");ok(e.length,"First text input field helper generated.");equal(e.text(),"Enter Your Full Name","First input field helper text populated correctly.");var f=a("#object-2 input:text:eq(1)");ok(f.length,"Second text input field generated.");equal(f.val(),"18","Second input field value populated correctly.");var b=a("#object-2 fieldset").attr("alpaca-field-id");var i=a("#object-2 fieldset legend");ok(i.length,"Fieldset label generated.");equal(i.text(),"Customer Profile","Fieldset label text populated correctly");var g=a("#object-2 fieldset .alpaca-fieldset-helper");ok(g.length,"Fieldset helper generated.");equal(g.text(),"Customer Contact Information","Fieldset helper text populated correctly");start()}})});test("Object with data and schema.",function(){stop();var b={name:"James Bond",age:45,icecream:["Chocolate","Vanilla","Strawberry"],address:{street:["100 Main Street","Suite 200"],city:"Burlington",state:"MA",zip:"18210"}};a("#object-3").alpaca({data:b,schema:{title:"Customer Profile",description:"Alpaca Ice Cream Customer Profile",type:"object",properties:{name:{title:"Full Name",type:"string"},age:{title:"Age",type:"number"},icecream:{title:"Favorite Ice Cream",type:"array"},address:{title:"Home Address",type:"object",properties:{street:{title:"Street Address",type:"array",items:{type:"string",maxLength:30,minItems:1,maxItems:3}},city:{title:"City",type:"string"},state:{title:"State",type:"string"},zip:{title:"Zip Code",type:"string"}}}}},options:{fields:{address:{fields:{street:{collapsed:true,itemLabel:"Line"}}}}},postRender:function(e){expect(5);deepEqual(e.getValue(),b,"Object field getValue() method returns correct value.");var c=a("#object-3 > fieldset > .alpaca-fieldset-items-container > div:eq(3) > fieldset");ok(c.length,"Fieldset for address field generated.");var f=a(".alpaca-fieldset-items-container fieldset",c);ok(f.length,"Fieldset for street field generated.");var d=a(".alpaca-controlfield-label:eq(0)",f);ok(d.length,"Street field label generated.");equal(d.text(),"Line 1","Street field label text populated correctly.");start()}})});test("Object field with default value.",function(){stop();a("#object-4").alpaca({schema:{title:"Customer Profile",description:"Customer Contact Information",type:"object","default":'{"name":"Taylor Swift","age":18}',properties:{name:{title:"Full Name",description:"Enter Your Full Name",type:"string"},age:{title:"Age",type:"number"}}},postRender:function(c){expect(12);var h=a("#object-4 input:text:eq(0)");ok(h.length,"First text input field generated.");equal(h.val(),"Taylor Swift","First input field value populated correctly.");var j=h.attr("id");var d=a("#object-4 #"+j+"-controlfield-label > div");ok(d.length,"First text input field label generated.");equal(d.text(),"Full Name","First input field label text populated correctly.");var e=a("#object-4 #"+j+"-controlfield-helper .alpaca-controlfield-helper-text");ok(e.length,"First text input field helper generated.");equal(e.text(),"Enter Your Full Name","First input field helper text populated correctly.");var f=a("#object-4 input:text:eq(1)");ok(f.length,"Second text input field generated.");equal(f.val(),"18","Second input field value populated correctly.");var b=a("#object-4 fieldset").attr("alpaca-field-id");var i=a("#object-4 fieldset legend");ok(i.length,"Fieldset label generated.");equal(i.text(),"Customer Profile","Fieldset label text populated correctly");var g=a("#object-4 fieldset .alpaca-fieldset-helper");ok(g.length,"Fieldset helper generated.");equal(g.text(),"Customer Contact Information","Fieldset helper text populated correctly");start()}})})}(jQuery));(function(a){module("fields: integer");test("Simple object field with only integer data input.",function(){stop();a("#integer-1").alpaca({data:18,postRender:function(b){expect(3);equal(b.getValue(),18,"Integer field getValue() method returns correct value.");var c=a("#integer-1 input:text");ok(c.length,"Input field generated.");equal(c.val(),"18","Input field value populated correctly.");start()}})});test("Integer field with data and schema.",function(){stop();a("#integer-2").alpaca({data:17,options:{type:"integer",label:"Age:",helper:"Guess Talyor Swift's Age"},schema:{minimum:18,maximum:25,exclusiveMinimum:true,exclusiveMaximum:true,divisibleBy:2},postRender:function(c){expect(17);var f=a("#integer-2 input:text");ok(f.length,"Input field generated.");equal(f.val(),"17","Input field value populated correctly.");var h=f.attr("id");var b=a("#integer-2 #"+h+"-controlfield-label > div");ok(b.length,"Input field label generated.");equal(b.text(),"Age:","Input field label text populated correctly.");var g=a("#integer-2 #"+h+"-controlfield-helper .alpaca-controlfield-helper-text");ok(g.length,"Input field helper generated.");equal(g.text(),"Guess Talyor Swift's Age","Input field helper text populated correctly.");var e=a("#integer-2 #"+h+"-field-message-0 > .alpaca-controlfield-message-text");ok(e.length,"First integer field invalid message generated.");equal(e.text(),Alpaca.substituteTokens(c.view.getMessage("stringDivisibleBy"),[2]),"First integer field invalid message text populated correctly.");var d=a("#integer-2 #"+h+"-field-message-1 > .alpaca-controlfield-message-text");ok(d.length,"Second integer field invalid message generated.");equal(d.text(),Alpaca.substituteTokens(c.view.getMessage("stringValueTooSmallExclusive"),[18]),"Second integer field invalid message text populated correctly.");f.blur(function(){if(f.val()=="26"){var j=a("#integer-2 .alpaca-field-invalid");ok(j.length,"Input field marked as invalid with value 26.");var i=a("#integer-2 .alpaca-controlfield-message-text");ok(i.length,"Field invalid message generated.");equal(i.text(),Alpaca.substituteTokens(c.view.getMessage("stringValueTooLargeExclusive"),[25]),"Invalid message text populated correctly.")}if(f.val()=="20"){var j=a("#integer-2 .alpaca-field-invalid");ok(j.length==0,"Input field marked as valid with value 20.")}if(f.val()=="20.1"){var j=a("#integer-2 .alpaca-field-invalid");ok(j.length,"Input field marked as invalid with value 20.1.");var i=a("#integer-2 .alpaca-controlfield-message-text");ok(i.length,"Field invalid message generated.");equal(i.text(),c.view.getMessage("stringNotAnInteger"),"Invalid message text populated correctly.")}});f.val("20");f.blur();f.val("26");f.blur();f.val("20.1");f.blur();start()}})});test("Integer field with data and schema.",function(){stop();a("#integer-3").alpaca({data:18,options:{type:"integer",label:"Snow Days:",helper:"Number of Snow Days in January 2011",slider:true},schema:{minimum:1,maximum:31},postRender:function(b){expect(4);var d=a("#integer-3 input:text");ok(d.length,"Input field generated.");equal(d.val(),"18","Input field value populated correctly.");var c=a("#integer-3 .ui-slider > a");ok(c.length,"Slider control generated.");equal(b.slider.slider("value"),18,"Slider location set correctly.");start()}})})}(jQuery));(function(a){module("fields: radio");test("Radio field with data, schema and options.",function(){stop();a("#radio-1").alpaca({data:"Coffee",options:{label:"Ice cream",helper:"Guess my favorite ice cream?"},schema:{"enum":["Vanilla","Chocolate","Coffee"]},postRender:function(c){expect(4);equal(c.getValue(),"Coffee","Radio groupd field getValue() method returns correct value.");var d=a("#radio-1 input:radio");equal(d.length,4,"Right number of radio controls generated.");var b=a("#radio-1 input:radio:checked");equal(b.length,1,"Checked radio control found.");equal(b.val(),"Coffee","Right radio control checked.");start()}})});test("Radio field with option labels.",function(){stop();a("#radio-2").alpaca({data:"Coffee2",options:{label:"Ice cream",helper:"Guess my favorite ice cream?",optionLabels:["Vanilla Flavor","Chocolate Flavor","Coffee Flavor"]},schema:{required:true,"enum":["Vanilla","Chocolate","Coffee"]},postRender:function(c){expect(12);var i=a("#radio-2 input:radio");equal(i.length,3,"Right number of radio controls generated.");var b=a("#radio-2 input:radio:checked");equal(b.length,1,"Checked radio control found.");equal(b.val(),"Vanilla","Right radio control checked.");var f=a("#radio-2 .alpaca-field-invalid");ok(f.length,"Field marked as invalid with value Coffee2.");var e=a("#radio-2 .alpaca-controlfield-message-text");ok(e.length,"Field invalid message generated.");equal(e.text(),Alpaca.substituteTokens(c.view.getMessage("invalidValueOfEnum"),["Vanilla,Chocolate,Coffee"]),"Invalid message text populated correctly.");var h=a("#radio-2 .alpaca-controlfield-radio-label:eq(0)");ok(h.length,"First option right label generated.");equal(h.text(),"Vanilla Flavor","First option right label text populated correctly.");var g=a("#radio-2 .alpaca-controlfield-radio-label:eq(1)");ok(g.length,"Second option right label generated.");equal(g.text(),"Chocolate Flavor","Second option right label text populated correctly.");var d=a("#radio-2 .alpaca-controlfield-radio-label:eq(2)");ok(d.length,"Third option right label generated.");equal(d.text(),"Coffee Flavor","Third option right label text populated correctly.");start()}})});test("Radio field with option labels.",function(){stop();a("#radio-3").alpaca({data:3,options:{label:"Rate My Ice cream",helper:"Please rate my ice cream",optionLabels:["Bad","Ok","Good"]},schema:{required:true,"enum":[1,2,3]},postRender:function(c){expect(10);var g=a("#radio-3 input:radio");equal(g.length,3,"Right number of radio controls generated.");var b=a("#radio-3 input:radio:checked");equal(b.length,1,"Checked radio control found.");equal(b.val(),"3","Right radio control checked.");var f=a("#radio-3 .alpaca-controlfield-radio-label:eq(0)");ok(f.length,"First option right label generated.");equal(f.text(),"Bad","First option right label text populated correctly.");var e=a("#radio-3 .alpaca-controlfield-radio-label:eq(1)");ok(e.length,"Second option right label generated.");equal(e.text(),"Ok","Second option right label text populated correctly.");var d=a("#radio-3 .alpaca-controlfield-radio-label:eq(2)");ok(d.length,"Third option right label generated.");equal(d.text(),"Good","Third option right label text populated correctly.");ok(c.getValue()===3,"Return value with right type.");start()}})});test("Radio field for boolean type.",function(){stop();a("#radio-4").alpaca({data:false,options:{type:"radio",label:"Rate My Ice cream",helper:"Please rate my ice cream",optionLabels:["Good","Bad"]},schema:{type:"boolean",required:true,"default":true,"enum":[true,false]},postRender:function(b){expect(1);ok(b.getValue()===false,"Return value with right type.");start()}})})}(jQuery));(function(a){module("fields: select");test("Select field with data, schema and options.",function(){stop();a("#select-1").alpaca({data:"Coffee",options:{label:"Ice cream",helper:"Guess my favorite ice cream?"},schema:{"enum":["Vanilla","Chocolate","Coffee","Strawberry","Mint"]},postRender:function(d){expect(4);equal(d.getValue(),"Coffee","Select field getValue() method returns correct value.");var b=a("#select-1 select > option");equal(b.length,6,"Right number of select options generated.");var c=a("#select-1 select > option:selected");equal(c.length,1,"Checked select control found.");equal(c.val(),"Coffee","Right select control checked.");start()}})});test("Select field with option labels.",function(){stop();a("#select-2").alpaca({data:"Coffee",options:{label:"Ice cream",helper:"Guess my favorite ice cream?",optionLabels:["Vanilla Flavor","Chocolate Flavor","Coffee Flavor"]},schema:{"enum":["Vanilla","Chocolate","Coffee","Strawberry","Mint"]},postRender:function(d){expect(6);var b=a("#select-2 select > option");equal(b.length,6,"Right number of select options generated.");var c=a("#select-2 select > option:selected");equal(c.length,1,"Checked select control found.");equal(c.val(),"Coffee","Right select control checked.");var g=a("#select-2 select > option:eq(1)");equal(g.text(),"Vanilla Flavor","First option right label text populated correctly.");var f=a("#select-2 select > option:eq(2)");equal(f.text(),"Chocolate Flavor","Second option right label text populated correctly.");var e=a("#select-2 select > option:eq(3)");equal(e.text(),"Coffee Flavor","Third option right label text populated correctly.");start()}})});test("Select field with options loaded from external data source.",function(){stop();a("#select-3").alpaca({options:{label:"Ice cream",helper:"Guess my favorite ice cream?",type:"select",dataSource:"../examples/components/fields/data/icecream-list.html"},postRender:function(c){expect(5);var b=a("#select-3 select > option");equal(b.length,5,"Right number of select options generated.");var g=a("#select-3 select > option:eq(1)");equal(g.text(),"Vanilla Flavor","First option right label text populated correctly.");var f=a("#select-3 select > option:eq(2)");equal(f.text(),"Chocolate Flavor","Second option right label text populated correctly.");var e=a("#select-3 select > option:eq(3)");equal(e.text(),"Strawberry Flavor","Third option right label text populated correctly.");var d=a("#select-3 select > option:eq(4)");equal(d.text(),"Mint Flavor","Fourth option right label text populated correctly.");start()}})});test("Multiple select field with options loaded from external data source.",function(){stop();a("#select-4").alpaca({data:["Vanilla","Chocolate"],options:{label:"Ice cream",helper:"Guess my favorite ice cream?",type:"select",multiple:true,size:3,dataSource:"../examples/components/fields/data/icecream-list.html"},postRender:function(d){expect(10);var b=a("#select-4 select > option");equal(b.length,5,"Right number of select options generated.");var k=a("#select-4 select > option:eq(1)");equal(k.text(),"Vanilla Flavor","First option right label text populated correctly.");var j=a("#select-4 select > option:eq(2)");equal(j.text(),"Chocolate Flavor","Second option right label text populated correctly.");var i=a("#select-4 select > option:eq(3)");equal(i.text(),"Strawberry Flavor","Third option right label text populated correctly.");var h=a("#select-4 select > option:eq(4)");equal(h.text(),"Mint Flavor","Fourth option right label text populated correctly.");var g=a("#select-4 select > option:selected");equal(g.length,2,"Right number of select options generated.");var f=a("#select-4 select > option:selected:eq(0)");equal(f.val(),"Vanilla","Right first option selected.");var e=a("#select-4 select > option:selected:eq(1)");equal(e.val(),"Chocolate","Right second option selected.");var c=a("#select-4 select");equal(c.attr("size"),"3","Select size option set correctly.");equal(c.attr("multiple"),"multiple","Select multiple option set correctly.");start()}})})}(jQuery));(function(a){module("fields: uppercase");test("Upper case field.",function(){stop();a("#uppercase-1").alpaca({data:"Ice cream is wonderful.",schema:{format:"uppercase"},postRender:function(b){expect(4);equal(b.getValue(),"ICE CREAM IS WONDERFUL.","Select field getValue() method returns correct value.");var c=a("#uppercase-1 input:text");ok(c.length,"Text input field generated.");equal(c.val(),"ICE CREAM IS WONDERFUL.","Text input field value populated correctly.");c.val("ice cream");c.keypress(function(){Alpaca.later(50,b,function(){equal(c.val(),"ICE CREAM","Text input converted to upper case automatically.");start()})});c.keypress()}})})}(jQuery));(function(a){module("fields: lowercase");test("Lower case field.",function(){stop();a("#lowercase-1").alpaca({data:"Ice Cream Is Wonderful.",schema:{format:"lowercase"},postRender:function(b){expect(4);equal(b.getValue(),"ice cream is wonderful.","Select field getValue() method returns correct value.");var c=a("#lowercase-1 input:text");ok(c.length,"Text input field generated.");equal(c.val(),"ice cream is wonderful.","Text input field value populated correctly.");c.val("ICE CREAM");c.keypress(function(){Alpaca.later(50,b,function(){equal(c.val(),"ice cream","Text input converted to lower case automatically.");start()})});c.keypress()}})})}(jQuery));(function(a){module("fields: ipv4");test("Upper case field.",function(){stop();a("#ipv4-1").alpaca({data:"100.60",schema:{format:"ip-address"},postRender:function(b){expect(7);equal(b.getValue(),"100.60","IP address field getValue() method returns correct value.");var e=a("#ipv4-1 input:text");ok(e.length,"Text input field generated.");equal(e.val(),"100.60","Text input field value populated correctly.");var d=a("#ipv4-1 .alpaca-field-invalid");ok(d.length,"Input field marked as invalid.");var c=a("#ipv4-1 .alpaca-controlfield-message-text");ok(c.length,"Field error message generated.");equal(c.text(),b.view.getMessage("invalidIPv4"),"Error message text populated correctly.");e.blur(function(){if(e.val()=="192.168.0.1"){var f=a("#ipv4-1 .alpaca-field-invalid");ok(f.length==0,"Input field marked as valid with value 192.168.0.1.")}});e.val("192.168.0.1");e.blur();start()}})})}(jQuery));(function(a){module("fields: date");test("Date field.",function(){stop();a("#date-1").alpaca({data:"10/105/2001",schema:{format:"date"},postRender:function(b){expect(7);equal(b.getValue(),"10/105/2001","Date field getValue() method returns correct value.");var e=a("#date-1 input:text");ok(e.length,"Text input field generated.");equal(e.val(),"10/105/2001","Text input field value populated correctly.");var d=a("#date-1 .alpaca-field-invalid");ok(d.length,"Input field marked as invalid.");var c=a("#date-1 .alpaca-controlfield-message-text");ok(c.length,"Field error message generated.");equal(c.text(),Alpaca.substituteTokens(b.view.getMessage("invalidDate"),[b.options.dateFormat]),"Error message text populated correctly.");e.blur(function(){if(e.val()=="10/10/2001"){var f=a("#date-1 .alpaca-field-invalid");ok(f.length==0,"Input field marked as valid with value 10/10/2001.")}});e.val("10/10/2001");e.blur();start()}})})}(jQuery));(function(a){module("fields: password");test("Password field.",function(){stop();a("#password-1").alpaca({data:"password",schema:{format:"password"},postRender:function(b){expect(3);equal(b.getValue(),"password","Password field getValue() method returns correct value.");var c=a("#password-1 input:password");ok(c.length,"Password input field generated.");equal(c.val(),"password","Password input field value populated correctly.");start()}})})}(jQuery));(function(a){module("fields: email");test("Email field.",function(){stop();a("#email-1").alpaca({data:"support",schema:{format:"email"},postRender:function(b){expect(7);equal(b.getValue(),"support","Email field getValue() method returns correct value.");var e=a("#email-1 input:text");ok(e.length,"Text input field generated.");equal(e.val(),"support","Text input field value populated correctly.");var d=a("#email-1 .alpaca-field-invalid");ok(d.length,"Input field marked as invalid.");var c=a("#email-1 .alpaca-controlfield-message-text");ok(c.length,"Field error message generated.");equal(c.text(),b.view.getMessage("invalidEmail"),"Error message text populated correctly.");e.blur(function(){if(e.val()=="admin@alpaca.org"){var f=a("#email-1 .alpaca-field-invalid");ok(f.length==0,"Input field marked as valid with value 10/10/2001.")}});e.val("admin@alpaca.org");e.blur();start()}})})}(jQuery));(function(a){module("fields: phone");test("Phone field.",function(){stop();a("#phone-1").alpaca({data:"",schema:{format:"phone"},postRender:function(b){expect(6);var c=a("#phone-1 input:text");ok(c.length,"Text input field generated.");c.focus(function(){equal(c.val(),"(___) ___-____","Text mask generated correctly.");c.blur(function(){if(c.val()==""){var e=a("#phone-1 .alpaca-field-invalid");ok(e.length,"Input field marked as invalid with value (123) 456-.");var d=a("#phone-1 .alpaca-controlfield-message-text");ok(d.length,"Field error message generated.");equal(d.text(),b.view.getMessage("invalidPhone"),"Error message text populated correctly.")}if(c.val()=="(123) 456-7890"){var e=a("#phone-1 .alpaca-field-invalid");ok(e.length==0,"Input field marked as valid with value (123) 456-7890.")}});c.val("(123) 456-");c.blur();c.val("(123) 456-7890");c.blur()});c.focus();start()}})})}(jQuery));(function(a){module("fields: textarea");test("Textarea field with options.",function(){stop();var b="Ice cream or ice-cream is a frozen dessert usually made from dairy products, such as milk and cream, and often combined with fruits or other ingredients and flavours.";a("#textarea-1").alpaca({data:b,options:{type:"textarea",label:"Receipt",helper:"Receipt for Best Homemade Ice Cream",rows:6,cols:80},postRender:function(c){expect(5);equal(c.getValue(),b,"Textarea field getValue() method returns correct value.");var d=a("#textarea-1 textarea");ok(d.length,"Textarea input field generated.");equal(d.val(),b,"Textarea input field value populated correctly.");equals(d.attr("cols"),80,"Textarea has right number of columns.");equals(d.attr("rows"),6,"Textarea has right number of rows.");start()}})})}(jQuery));(function(a){module("fields: wysiwyg");test("Wysiwyg editor.",function(){stop();var b="Ice cream or ice-cream is a frozen dessert usually made from dairy products, such as milk and cream, and often combined with fruits or other ingredients and flavours.";a("#wysiwyg-1").alpaca({data:b,options:{type:"wysiwyg"},postRender:function(c){expect(2);equal(c.getValue(),b,"Wysiwyg editor getValue() method returns correct value.");var d=a("#wysiwyg-1 .wysiwyg");equal(d.length,1,"Wysiwyg editor field generated.");start()}})})}(jQuery));(function(a){module("fields: file");test("File field.",function(){stop();var b="Ice cream or ice-cream is a frozen dessert usually made from dairy products, such as milk and cream, and often combined with fruits or other ingredients and flavours.";a("#file-1").alpaca({data:"",options:{type:"file",label:"Ice Cream Photo:",helper:"Pick your favorite ice cream picture."},postRender:function(d){expect(5);var e=a("#file-1 input:file");ok(e.length,"File input field generated.");var c=a("#file-1 .alpaca-controlfield-label>div");ok(c.length,"Input field label generated.");equal(c.text(),"Ice Cream Photo:","Label text populated correctly.");var f=a("#file-1 .alpaca-controlfield-helper > span.alpaca-controlfield-helper-text");ok(f.length,"Input field helper generated.");equal(f.text(),"Pick your favorite ice cream picture.","Helper text populated correctly.");start()}})})}(jQuery));(function(a){module("fields: address");test("Address field with options.",function(){stop();var b={street:["100 Main Street","Suite 200"],city:"Burlington",state:"MA",zip:"18210"};a("#address-1").alpaca({data:b,options:{type:"address",addressValidation:true},schema:{title:"Home Address",type:"any"},postRender:function(d){expect(7);deepEqual(d.getValue(),b,"Address field getValue() method returns correct value.");equal(d.getAddress(),"100 Main Street Suite 200 Burlington MA 18210","Address field getAddress() method returns correct value.");var f=a("#address-1 fieldset");ok(f.length,"Address input field generated.");var e=a("select > option",f);equal(e.length,60,"Address state select field generated correctly.");var c=a('.alpaca-fieldset-items-container input[name="zip"]',f);ok(c.length,"Address zip field correctly.");equal(c.attr("size"),5,"Address zip field generated with right size.");c.focus(function(){equal(c.val(),"_____","Address zip field text mask generated correctly.")});c.val("");c.focus();start()}})})}(jQuery));(function(a){module("fields: dependency");test("Field dependecy through schema dependency properties.",function(){stop();a("#dependency-1").alpaca({data:{},schema:{title:"Ice Cream Picker",description:"Select Your Favorite Ice Cream",type:"object",properties:{fan:{title:"Alpaca Ice Cream Lover?",type:"boolean",description:"Say YES If You Are Truly An Alpaca Ice Cream Lover."},icecream:{title:"Favorite Ice Cream",type:"String","enum":["Vanilla","Chocolate","Coffee","Strawberry","Mint"],dependencies:"fan"},topping:{title:"Favorite Topping",type:"String","enum":["Marshmelllow","Chocolate Chip","Caramel","Cookie Dough"],dependencies:["icecream"]}}},postRender:function(e){expect(9);var f=a("#dependency-1 fieldset");ok(f.length,"Object field generated.");var d=a(".alpaca-fieldset-items-container > div:eq(0) input:checkbox",f);var i=a(".alpaca-fieldset-items-container > div:eq(0) > span",f);ok(d.length,"Input field for fan property generated.");notEqual(i.css("display"),"none","Input field for fan property shown.");var c=a(".alpaca-fieldset-items-container > div:eq(1) select",f);var h=a(".alpaca-fieldset-items-container > div:eq(1) > span",f);ok(c.length,"Input field for icecream property generated.");equal(h.css("display"),"none","Input field for icecream property hidden.");var b=a(".alpaca-fieldset-items-container > div:eq(2) select",f);var g=a(".alpaca-fieldset-items-container > div:eq(2) > span",f);ok(b.length,"Input field for topping property generated.");equal(g.css("display"),"none","Input field for topping property hidden.");d.change(function(){h=a(".alpaca-fieldset-items-container > div:eq(1) > span");notEqual(h.css("display"),"none","Input field for icecream property shown after after checkbox for fan property is checked.");c.change(function(){g=a(".alpaca-fieldset-items-container > div:eq(2) > span");notEqual(g.css("display"),"none","Input field for topping property shown after after select for icecream property is selected.")});c.val("Vanilla").attr("selected",true);c.change()});d.change();start()}})})}(jQuery));(function(a){module("fields: conditional");test("Conditional field through combination of schema dependency properties and options dependency properties.",function(){stop();a("#conditional-1").alpaca({data:{},options:{fields:{flavour:{dependencies:{choice:"Flavour"}},topping:{dependencies:{choice:"Topping"}}}},schema:{title:"Ice Cream Picker",description:"Select Your Favorite Ice Cream",type:"object",properties:{choice:{title:"Select",type:"String",description:"What do you want to choose?","enum":["Flavour","Topping"]},flavour:{title:"Flavour",type:"String","enum":["Vanilla","Chocolate","Coffee","Strawberry","Mint"],dependencies:"choice"},topping:{title:"Topping",type:"String","enum":["Marshmelllow","Chocolate Chip","Caramel","Cookie Dough"],dependencies:"choice"}}},view:"VIEW_WEB_EDIT_LIST",postRender:function(j){expect(11);var l=a("#conditional-1 fieldset");ok(l.length,"Object field generated.");var k=a(".alpaca-fieldset-items-container > li:eq(0) input:radio:eq(0)",l);var c=a(".alpaca-fieldset-items-container > li:eq(0) > span",l);ok(k.length,"Input field for choice property generated.");notEqual(c.css("display"),"none","Input field for choice property shown.");var d=k.attr("name");var h=k;var f=a(".alpaca-fieldset-items-container > li:eq(0) input:radio:eq(1)",l);var e=a(".alpaca-fieldset-items-container > li:eq(0) input:radio:eq(2)",l);var i=a(".alpaca-fieldset-items-container > li:eq(1) select",l);var b=a(".alpaca-fieldset-items-container > li:eq(1) > span",l);ok(i.length,"Input field for icecream property generated.");equal(b.css("display"),"none","Input field for icecream property hidden.");var g=a(".alpaca-fieldset-items-container > li:eq(2) select",l);var m=a(".alpaca-fieldset-items-container > li:eq(2) > span",l);ok(g.length,"Input field for topping property generated.");equal(m.css("display"),"none","Input field for topping property hidden.");f.change(function(){Alpaca.later(50,j,function(){b=a(".alpaca-fieldset-items-container > li:eq(1) > span");notEqual(b.css("display"),"none","Input field for icecream property shown if option Flavour of choice field is selected..");m=a(".alpaca-fieldset-items-container > li:eq(2) > span");equal(m.css("display"),"none","Input field for topping property hidden if option Flavour of choice field is selected.");e.attr("checked",true);e.change()})});e.change(function(){Alpaca.later(50,j,function(){b=a(".alpaca-fieldset-items-container > li:eq(1) > span");equal(b.css("display"),"none","Input field for icecream property hidden if option Topping of choice field is selected..");m=a(".alpaca-fieldset-items-container > li:eq(2) > span");notEqual(m.css("display"),"none","Input field for topping property shown if option Topping of choice field is selected.");start()})});f.attr("checked",true);f.change()}})})}(jQuery));(function(a){module("fields: form and buttons");test("Form and buttons.",function(){stop();a("#form-1").alpaca({data:{name:"Britney Spears",feedback:"Alpaca is very cute.",ranking:"excellent"},schema:{title:"User Feedback",description:"What do you think about Alpaca?",type:"object",properties:{name:{type:"string",title:"Name",required:true},feedback:{type:"string",title:"Feedback"},ranking:{type:"string",title:"Ranking","enum":["excellent","ok","so so"],required:true}}},options:{renderForm:true,form:{attributes:{action:"../../endpoints/save.php",method:"post"},buttons:{submit:{},reset:{}}},fields:{helper:"Tell us what you think about Alpaca!",name:{size:20,helper:"Please enter your name."},feedback:{type:"textarea",name:"your_feedback",rows:5,cols:30,helper:"Please enter your feedback."},ranking:{type:"select",helper:"Select your ranking.",optionLabels:["Awesome!","It's Ok","Hmm..."]}}},postRender:function(c){expect(5);var e=a("#form-1 form");ok(e.length,"Form generated.");equal(e.attr("action"),"../../endpoints/save.php","Form field action attribute populated correctly.");equal(e.attr("method"),"post","Form field method attribute populated correctly.");var b=a("#form-1 form input:submit");ok(b.length,"Submit button generated.");var d=a("#form-1 form input:reset");ok(d.length,"Reset button generated.");start()}})})}(jQuery));(function(a){module("fields: time");test("Time field.",function(){stop();a("#time-1").alpaca({data:"10:75:76",schema:{format:"time"},postRender:function(b){expect(7);equal(b.getValue(),"10:75:76","Time field getValue() method returns correct value.");var e=a("#time-1 input:text");ok(e.length,"Text input field generated.");equal(e.val(),"10:75:76","Text input field value populated correctly.");var d=a("#time-1 .alpaca-field-invalid");ok(d.length,"Input field marked as invalid.");var c=a("#time-1 .alpaca-controlfield-message-text");ok(c.length,"Field error message generated.");equal(c.text(),Alpaca.substituteTokens(b.view.getMessage("invalidTime"),[b.options.timeFormat]),"Error message text populated correctly.");e.blur(function(){if(e.val()=="10:10:16"){var f=a("#time-1 .alpaca-field-invalid");ok(f.length==0,"Input field marked as valid with value 10:10:16.")}});e.val("10:10:16");e.blur();start()}})})}(jQuery));(function(a){module("fields: tag");test("Tag field.",function(){stop();a("#tag-1").alpaca({data:["tag1","Tag2 "," tAg3"],options:{type:"tag"},postRender:function(b){expect(5);var c=a("#tag-1 input:text");ok(c.length,"Text input field generated.");c.blur();same(b.getValue(),["tag1","tag2","tag3"],"Tag field getValue() methods returns expected value.");equal(c.val(),"tag1,tag2,tag3","Text input field value populated correctly.");c.val("new taG1, new TAG2, new tag3 ");c.blur();equal(c.val(),"new tag1,new tag2,new tag3","Text input field value populated correctly after user input.");same(b.getValue(),["new tag1","new tag2","new tag3"],"Tag field getValue() methods returns expected value.");start()}})})}(jQuery));(function(a){module("fields: map");test("Map field.",function(){stop();a("#map-1").alpaca({data:{john316:{firstName:"Tim",lastName:"Tebow",gender:"Male"}},schema:{type:"array",items:{type:"object",properties:{_key:{title:"User Id"},firstName:{title:"First Name",description:"Enter user's first name."},lastName:{title:"Last Name",description:"Enter user's last name."},gender:{title:"Gender",description:"Select user's gender","enum":["Male","Female"]}}}},options:{type:"map",fields:{item:{fields:{_key:{size:60,helper:"Provide a unique user id."}}}}},postRender:function(c){expect(15);var b=a("#map-1 .alpaca-fieldset-array-item-toolbar-add");ok(b.length,"Array toolbar with add button generated.");b.click(function(){var l=a("#map-1 .alpaca-fieldset-items-container fieldset:eq(0)");var j=l.attr("alpaca-field-id");ok(l.length,"New object field generated.");var i=a("input:text:eq(0)",l);ok(i.length,"New object first text input field generated.");equal(i.val(),"john316","Id field for new object populated with correct value.");var n=i.attr("id");var g=a("#"+n+"-controlfield-label > div",l);ok(g.length,"Label for new object first text input field generated.");equal(g.text(),"User Id","Label for new object first text input field populated with correct text.");var h=a("input:text:eq(1)",l);ok(h.length,"New object second text input field generated.");var e=h.attr("id");var k=a("#"+e+"-controlfield-label > div",l);ok(k.length,"Label for new object second text input field generated.");equal(k.text(),"First Name","Label for second object first text input field populated with correct text.");var f=a("#map-1 fieldset.alpaca-field-invalid");ok(f.length,"Array marked as invalid.");var m=f.attr("alpaca-field-id");var d=a("#map-1 #"+m+"-field-message-0 > .alpaca-controlfield-message-text");ok(d.length,"Array invalid message generated.");equal(d.text(),c.view.getMessage("keyNotUnique"),"Array invalid text populated correctly.");i.blur(function(){if(i.val()=="john326"){var p=a("#map-1 fieldset.alpaca-field-invalid");ok(p.length==0,"Array marked as valid with new key.");var o=c.getValue();ok(o.john316!=null,"Map value contains john316 key");ok(o.john326!=null,"Map value contains john326 key")}});i.val("john326");i.blur()});b.click();start()}})})}(jQuery));(function(a){module("validation: validation");test("Required field.",function(){stop();a("#validation-1").alpaca({data:"",schema:{title:"Required field",type:"string",required:true},postRender:function(b){expect(5);var e=a("#validation-1 input:text");ok(e.length,"Text input field generated.");var d=a("#validation-1 .alpaca-field-invalid");ok(d.length,"Input field marked as invalid.");var c=a("#validation-1 .alpaca-controlfield-message-text");ok(c.length,"Field error message generated.");equal(c.text(),b.view.getMessage("notOptional"),"Error message text populated correctly.");e.blur(function(){if(e.val()=="test"){var f=a("#validation-1 .alpaca-field-invalid");ok(f.length==0,"Input field marked as valid with value test.")}});e.val("test");e.blur();e.focus();start()}})});test("Field with disallowed values.",function(){stop();a("#validation-2").alpaca({data:"book",schema:{title:"Diallowed value",type:"string",disallow:["book","pencil"]},postRender:function(b){expect(5);var e=a("#validation-2 input:text");ok(e.length,"Text input field generated.");var d=a("#validation-2 .alpaca-field-invalid");ok(d.length,"Input field marked as invalid.");var c=a("#validation-2 .alpaca-controlfield-message-text");ok(c.length,"Field error message generated.");equal(c.text(),Alpaca.substituteTokens(b.view.getMessage("disallowValue"),["book,pencil"]),"Error message text populated correctly.");e.blur(function(){if(e.val()=="book2"){var f=a("#validation-1 .alpaca-field-invalid");ok(f.length==0,"Input field marked as valid with value book2.")}});e.val("book2");e.blur();e.focus();start()}})});test("JSON schema validator.",function(){expect(2);var b="book";var d="book2";var c={title:"Enum field",type:"string","enum":["book","pen","eraser"]};ok(Validator.validate(b,c).valid,"Data1 is valid against the schema.");ok(!Validator.validate(d,c).valid,"Data2 is invalid against the schema.")});test("Custom validator.",function(){stop();a("#validation-4").alpaca({data:"book",schema:{title:"Diallowed value",type:"string",disallow:["book","pencil"]},options:{validator:function(b,d){var c=b.getValue();if(c=="pen"||c=="book"){d({message:"Invalid value (custom validator)",status:false})}else{d({message:"Valid value (custom validator)",status:true})}}},postRender:function(b){expect(9);var e=a("#validation-4 input:text");ok(e.length,"Text input field generated.");var d=a("#validation-4 .alpaca-field-invalid");ok(d.length,"Input field marked as invalid.");var c=a("#validation-4 .alpaca-controlfield-message-text:eq(1)");ok(c.length,"Field error message generated.");equal(c.text(),"Invalid value (custom validator)","Error message text populated correctly.");e.blur(function(){if(e.val()=="pen"){c=a("#validation-4 .alpaca-controlfield-message-text:eq(0)");ok(c.length,"Field error message generated.");equal(c.text(),"Invalid value (custom validator)","Error message text populated correctly.")}if(e.val()=="pencil"){c=a("#validation-4 .alpaca-controlfield-message-text:eq(0)");ok(c.length,"Field error message generated.");equal(c.text(),Alpaca.substituteTokens(b.view.getMessage("disallowValue"),["book,pencil"]),"Error message text populated correctly.")}if(e.val()=="pen2"){var f=a("#validation-4 .alpaca-field-invalid");ok(f.length==0,"Input field marked as valid with value book2.")}});e.val("pen2");e.blur();e.val("pen");e.blur();e.val("pencil");e.blur();start()}})})}(jQuery));(function(a){module("wizard: wizard");test("Configuration-based wizard without using a layout template.",function(){stop();a("#wizard-1").alpaca({data:"../examples/components/wizards/customer-profile-data.json",options:"../examples/components/wizards/customer-profile-options.json",schema:"../examples/components/wizards/customer-profile-schema.json",view:{parent:"VIEW_WEB_EDIT_LIST",wizard:{renderWizard:true,statusBar:true,validation:true,steps:3,bindings:{name:1,age:1,gender:1,photo:1,member:2,phone:2,icecream:2,address:3},stepTitles:[{title:"Basic",description:"Name, Age etc."},{title:"Membership",description:"Favorite, Member etc."},{title:"Contact",description:"Phone, Address etc."}]}},postRender:function(e){expect(29);var c=a("#wizard-1 fieldset");ok(c.length,"Fieldset for wizard generated.");var g=a(".alpaca-wizard-status-bar",c);ok(g.length,"Wizard status bar generated.");var h=a("li",g);equal(h.length,3,"Right number of step heads generated.");var d=a("#step0",c);ok(d.length,"Step 1 of wizard generated.");notEqual(d.css("display"),"none","Step 1 of wizard shown.");var i=a("#step1",c);ok(i.length,"Step 2 of wizard generated.");equal(i.css("display"),"none","Step 2 of wizard hidden.");var f=a("#step2",c);ok(f.length,"Step 3 of wizard generated.");equal(f.css("display"),"none","Step 3 of wizard hidden.");var b=a("button#step0-button-next",d);ok(b.length,"Next button for step 1 generated");equal(b.text(),"Next","Text for stepv1 next button populated correctly.");b.click(function(){notEqual(i.css("display"),"none","Step 2 of wizard shown.");equal(d.css("display"),"none","Step 1 of wizard hidden.");equal(f.css("display"),"none","Step 3 of wizard hidden.");var j=a("button#step1-button-next",i);ok(j.length,"Next button for step 2 generated");equal(j.text(),"Next","Text for step 2 next button populated correctly.");j.click(function(){notEqual(f.css("display"),"none","Step 3 of wizard shown.");equal(d.css("display"),"none","Step 1 of wizard hidden.");equal(i.css("display"),"none","Step 2 of wizard hidden.");var k=a("button#step2-button-pre",f);ok(k.length,"Back button for step 3 generated");equal(k.text(),"Back","Text for step 3 back button populated correctly.");k.click(function(){notEqual(i.css("display"),"none","Step 2 of wizard shown.");equal(d.css("display"),"none","Step 1 of wizard hidden.");equal(f.css("display"),"none","Step 3 of wizard hidden.");var l=a("button#step1-button-pre",i);ok(l.length,"Back button for step 2 generated");equal(l.text(),"Back","Text for step 2 back button populated correctly.");l.click(function(){notEqual(d.css("display"),"none","Step 1 of wizard shown.");equal(i.css("display"),"none","Step 2 of wizard hidden.");equal(f.css("display"),"none","Step 3 of wizard hidden.")});l.click()});k.click()});j.click()});b.click();start()}})});test("Template-based wizard.",function(){stop();a("#wizard-2").alpaca({data:"../examples/components/wizards/customer-profile-data.json",options:"../examples/components/wizards/customer-profile-options.json",schema:"../examples/components/wizards/customer-profile-schema.json",view:{parent:"VIEW_WEB_EDIT_LIST",layout:{template:"../examples/components/wizards/wizard-template.html",bindings:{name:"alpaca-wizard-step-1",age:"alpaca-wizard-step-1",gender:"alpaca-wizard-step-1",photo:"alpaca-wizard-step-1",member:"alpaca-wizard-step-2",phone:"alpaca-wizard-step-2",icecream:"alpaca-wizard-step-2",address:"alpaca-wizard-step-3"}},wizard:{renderWizard:true,statusBar:true}},postRender:function(e){expect(29);var c=a("#wizard-2 .alpaca-wizard");ok(c.length,"Wizard generated.");var g=a("#wizard-2 .alpaca-wizard-status-bar");ok(g.length,"Wizard status bar generated.");var h=a("li",g);equal(h.length,3,"Right number of step heads generated.");var d=a("#step0",c);ok(d.length,"Step 1 of wizard generated.");notEqual(d.css("display"),"none","Step 1 of wizard shown.");var i=a("#step1",c);ok(i.length,"Step 2 of wizard generated.");equal(i.css("display"),"none","Step 2 of wizard hidden.");var f=a("#step2",c);ok(f.length,"Step 3 of wizard generated.");equal(f.css("display"),"none","Step 3 of wizard hidden.");var b=a("button#step0-button-next",d);ok(b.length,"Next button for step 1 generated");equal(b.text(),"Next","Text for stepv1 next button populated correctly.");b.click(function(){notEqual(i.css("display"),"none","Step 2 of wizard shown.");equal(d.css("display"),"none","Step 1 of wizard hidden.");equal(f.css("display"),"none","Step 3 of wizard hidden.");var j=a("button#step1-button-next",i);ok(j.length,"Next button for step 2 generated");equal(j.text(),"Next","Text for step 2 next button populated correctly.");j.click(function(){notEqual(f.css("display"),"none","Step 3 of wizard shown.");equal(d.css("display"),"none","Step 1 of wizard hidden.");equal(i.css("display"),"none","Step 2 of wizard hidden.");var k=a("button#step2-button-pre",f);ok(k.length,"Back button for step 3 generated");equal(k.text(),"Back","Text for step 3 back button populated correctly.");k.click(function(){notEqual(i.css("display"),"none","Step 2 of wizard shown.");equal(d.css("display"),"none","Step 1 of wizard hidden.");equal(f.css("display"),"none","Step 3 of wizard hidden.");var l=a("button#step1-button-pre",i);ok(l.length,"Back button for step 2 generated");equal(l.text(),"Back","Text for step 2 back button populated correctly.");l.click(function(){notEqual(d.css("display"),"none","Step 1 of wizard shown.");equal(i.css("display"),"none","Step 2 of wizard hidden.");equal(f.css("display"),"none","Step 3 of wizard hidden.")});l.click()});k.click()});j.click()});b.click();start()}})})}(jQuery));(function(a){module("forms: create");test("Form for creating new content.",function(){stop();a("#createform-1").alpaca({options:"../examples/forms/customer-profile/options.json",schema:"../examples/forms/customer-profile/schema.json",view:"VIEW_WEB_CREATE",postRender:function(c){expect(13);var e=a("#createform-1 form");ok(e.length,"Form generated.");equal(e.attr("action"),"../../endpoints/echo.php","Form field action attribute populated correctly.");equal(e.attr("method"),"post","Form field method attribute populated correctly.");var b=a("#createform-1 input:text");equal(b.length,5,"Right number of text input fields rendered.");equal(a("#createform-1 input:text:eq(0)").val(),"","Data not bounded for name text field.");equal(a("#createform-1 input:text:eq(1)").val(),"","Data not bounded for age text field.");equal(a("#createform-1 input:text:eq(2)").val(),"","Data not bounded for phone text field.");equal(a("#createform-1 input:text:eq(3)").val(),"","Data not bounded for city text field.");equal(a("#createform-1 input:text:eq(4)").val(),"","Data not bounded for zip text field.");equal(a("#createform-1 input:radio:checked").val(),"","Data not bounded for gender radio field.");equal(a("#createform-1 select:eq(0) > option:selected").val(),"","Data not bounded for favorite select field.");equal(a("#createform-1 select:eq(1) > option:selected").val(),"","Data not bounded for state select field.");var d=a("#createform-1 input:checkbox");equal(d.is(":checked"),false,"Data not bounded for membership checkbox field.");start()}})});test("Simple form for creating new content.",function(){stop();a("#createform-2").alpaca({options:"../examples/forms/customer-profile/simple-options.json",schema:"../examples/forms/customer-profile/schema.json",view:"VIEW_WEB_CREATE",postRender:function(c){expect(1);var b=a("#createform-2 span.alpaca-controlfield:visible");equal(b.length,2,"Right number of input fields are shown.");start()}})})}(jQuery));(function(a){module("forms: edit");test("Edit form with readonly fields.",function(){stop();a("#editform-1").alpaca({data:"../examples/forms/customer-profile/data.json",options:"../examples/forms/customer-profile/simple-options.json",schema:"../examples/forms/customer-profile/schema.json",view:{parent:"VIEW_WEB_EDIT",displayReadonly:true},postRender:function(b){expect(4);equal(a("#editform-1 input:text[readOnly]").length,7,"Right number of readonly text input fields rendered.");equal(a("#editform-1 input:radio[readOnly]").length,3,"Right number of readonly radio input fields rendered.");equal(a("#editform-1 select[readOnly]").length,1,"Right number of readonly select input fields rendered.");equal(a("#editform-2 span.alpaca-controlfield:hidden").length,0,"No hidden field.");start()}})});test("Simple form for editing content.",function(){stop();a("#editform-2").alpaca({data:"../examples/forms/customer-profile/data.json",options:"../examples/forms/customer-profile/simple-options.json",schema:"../examples/forms/customer-profile/schema.json",view:{parent:"VIEW_WEB_EDIT",displayReadonly:false},postRender:function(c){expect(1);var b=a("#editform-2 span.alpaca-controlfield:visible");equal(b.length,2,"Right number of input fields are shown.");start()}})})}(jQuery));